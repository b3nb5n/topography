// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

generator zod {
  provider      = "zod-prisma"
  output        = "./generated/schema"
  relationModel = false
  modelCase     = "camelCase"
  modelSuffix   = "Schema"
  useDecimalJs  = true
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Authentication

model Role {
  id          String       @id @db.Char(16)
  name        String       @unique
  invitations Invitation[]
  users       User[]
}

model Invitation {
  id     String @id @db.Char(16)
  email  String
  role   Role   @relation(fields: [roleId], references: [id])
  roleId String @db.Char(16)
}

model User {
  id        String @id @db.Char(16)
  role      Role   @relation(fields: [roleId], references: [id])
  roleId    String @db.Char(16)
  firstName String
  lastName  String
  email     String
  password  String
}

// Content

enum ResourceType {
  Property
  Collection
  Item
}

enum Visibility {
  Live
  Draft
  Archived
  Deleted
}

model Meta {
  id         String       @id @db.Char(16)
  type       ResourceType
  created    DateTime     @default(now())
  edited     DateTime     @updatedAt
  visibility Visibility   @default(Live)
  property   Property?
  collection Collection?
  item       Item?
}

model Property {
  id          String       @id @db.Char(16)
  meta        Meta         @relation(fields: [metaId], references: [id])
  metaId      String       @unique @db.Char(16)
  host        String?
  collections Collection[]
}

model Collection {
  id         String   @id @db.Char(16)
  meta       Meta     @relation(fields: [metaId], references: [id])
  metaId     String   @unique @db.Char(16)
  property   Property @relation(fields: [propertyId], references: [id])
  propertyId String   @db.Char(16)
  schema     Json     @db.Json
  items      Item[]
}

model Item {
  id           String     @id @db.Char(16)
  meta         Meta       @relation(fields: [metaId], references: [id])
  metaId       String     @unique @db.Char(16)
  collection   Collection @relation(fields: [collectionId], references: [id])
  collectionId String     @db.Char(16)
}
