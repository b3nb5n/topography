// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ResourceType {
  Property
  Collection
  Item
}

enum Visibility {
  Live
  Draft
  Archived
  Deleted
}

model Meta {
  id         String       @id @db.Char(16)
  type       ResourceType
  created    DateTime     @default(now())
  edited     DateTime     @updatedAt
  visibility Visibility   @default(Live)
  property   Property?
  collection Collection?
  item       Item?
}

model Property {
  id          String       @id @db.Char(16)
  meta        Meta         @relation(fields: [metaId], references: [id])
  metaId      String       @unique @db.Char(16)
  host        String?
  collections Collection[]
}

model Collection {
  id         String   @id @db.Char(16)
  meta       Meta     @relation(fields: [metaId], references: [id])
  metaId     String   @unique @db.Char(16)
  property   Property @relation(fields: [propertyId], references: [id])
  propertyId String   @db.Char(16)
  schema     Json @db.Json
  items      Item[]
}

model Item {
  id           String     @id @db.Char(16)
  meta         Meta       @relation(fields: [metaId], references: [id])
  metaId       String     @unique @db.Char(16)
  collection   Collection @relation(fields: [collectionId], references: [id])
  collectionId String     @db.Char(16)
}
